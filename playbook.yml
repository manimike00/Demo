---
# This playbook deploys a complete CKAN instance.

- name: Provision SOLR server
  hosts: solr
  gather_facts: true
  become: yes
  roles:
    - common
    - certificates
    - apache
    - solr

- name: Provision CKAN server
  hosts: ckan
  connection: local
  become: true
  gather_facts: true
  vars:
    ckan_branch: ckan-2.7.3 
    ckanext_oauth2_branch: master 
    ckanext_scheming_branch: master 
    ckanext_spatial_branch: master
    syngenta_theme_branch: Dev
    ckan_harvest_branch: 65e3163015079f425805a6b35458b1b1bf6d0ce0 
  roles:
    - { role: common,          tags: ['role_common'] }
    - { role: certificates,    tags: ['role_certificates'] }
    - { role: apache,          tags: ['role_apache'] }
    - { role: postgresql,      tags: ['role_postgresql'] }
    - { role: solr,            tags: ['role_solr'] }
    - { role: redis,           tags: ['role_redis'] }
    - { role: ckan,            tags: ['ckan']  }
    - { role: ckan-harvester,  tags: ['role_ckan_harvester'] }
