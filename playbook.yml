---
# This playbook deploys a complete CKAN instance.

- hosts: all
  vars:
    ansible_ssh_private_key_file: ./vagrant/ssh/vagrant
  pre_tasks:
    - name: Verify Ansible version meets requirements
      assert:
        that: "ansible_version.full is version_compare('2.4', '>=')"
        msg: >
          "You must update Ansible to at least 2.4 to deploy EPOS CKAN."


- name: Provision CKAN server
  hosts: all
  vars:
    ckan_database_password: test                           # CKAN Postgresql database password
    ckan_admin_password: test                                      # CKAN admin user ('ckanadmin') password
    ckan_harvest_password: test                                    # CKAN harvest user ('harvest') password
    epos_msl_version: development
    epos_msl_fqdn: 192.168.60.10                             # fully qualified domain name (FQDN)
    epos_msl_environment: development                              # environment: development, testing, acceptance or production
  become: yes
  roles:
    - common
    - certificates
    - apache
    - postgresql
    - solr
    - redis
    - ckan
    - ckan-harvester
